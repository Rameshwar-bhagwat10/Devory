generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Account {
  id                String  @id @default(dbgenerated("gen_random_uuid()::text"))
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model ai_usage_logs {
  id           String   @id @default(dbgenerated("gen_random_uuid()::text"))
  userId       String
  action       String
  projectId    String?
  tokensUsed   Int
  success      Boolean
  errorMessage String?
  createdAt    DateTime @default(now())
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([userId])
}

model audit_logs {
  id         String   @id @default(dbgenerated("gen_random_uuid()::text"))
  userId     String?
  action     String
  resource   String?
  resourceId String?
  metadata   String?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())
  user User?   @relation(fields: [userId], references: [id])

  @@index([action])
  @@index([createdAt])
  @@index([userId])
}

model community_collaboration_requests {
  id              String          @id @default(dbgenerated("gen_random_uuid()::text"))
  postId          String
  requesterId     String
  status          RequestStatus   @default(PENDING)
  createdAt       DateTime        @default(now())
  community_posts community_posts @relation(fields: [postId], references: [id], onDelete: Cascade)
  user User @relation(fields: [requesterId], references: [id], onDelete: Cascade)

  @@unique([postId, requesterId])
  @@index([postId])
  @@index([requesterId])
  @@index([status])
}

model community_comment_reactions {
  id                 String             @id @default(dbgenerated("gen_random_uuid()::text"))
  userId             String
  commentId          String
  createdAt          DateTime           @default(now())
  community_comments community_comments @relation(fields: [commentId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, commentId])
  @@index([commentId])
  @@index([userId])
}

model community_comments {
  id                          String                        @id @default(dbgenerated("gen_random_uuid()::text"))
  postId                      String
  userId                      String
  parentId                    String?
  content                     String
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime @updatedAt
  likesCount                  Int                           @default(0)
  community_comment_reactions community_comment_reactions[]
  community_comments          community_comments?           @relation("community_commentsTocommunity_comments", fields: [parentId], references: [id], onDelete: Cascade)
  other_community_comments    community_comments[]          @relation("community_commentsTocommunity_comments")
  community_posts             community_posts               @relation(fields: [postId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt(sort: Desc)])
  @@index([parentId])
  @@index([postId])
  @@index([userId])
}

model community_ideas {
  id             String           @id @default(dbgenerated("gen_random_uuid()::text"))
  userId         String
  title          String
  description    String
  domain         ProjectDomain
  tags           String[]
  status         IdeaStatus       @default(PENDING)
  likeCount      Int              @default(0)
  dislikeCount   Int              @default(0)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime @updatedAt
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  idea_reactions idea_reactions[]
  idea_reports   idea_reports[]

  @@index([createdAt])
  @@index([status])
  @@index([userId])
}

model community_post_views {
  id              String          @id @default(dbgenerated("gen_random_uuid()::text"))
  postId          String
  userId          String?
  ipAddress       String?
  createdAt       DateTime        @default(now())
  community_posts community_posts @relation(fields: [postId], references: [id], onDelete: Cascade)
  user User?          @relation(fields: [userId], references: [id])

  @@index([createdAt(sort: Desc)])
  @@index([postId])
  @@index([userId])
}

model community_posts {
  id                               String                             @id @default(dbgenerated("gen_random_uuid()::text"))
  userId                           String
  type                             PostType
  title                            String
  slug                             String                             @unique
  shortDescription                 String
  fullDescription                  String
  domain                           ProjectDomain
  difficulty                       ProjectDifficulty
  techStack                        Json                               @default("[]")
  tags                             Json                               @default("[]")
  estimatedDuration                String?
  viewsCount                       Int                                @default(0)
  likesCount                       Int                                @default(0)
  dislikesCount                    Int                                @default(0)
  commentsCount                    Int                                @default(0)
  trendingScore                    Float                              @default(0)
  status                           CollaborationStatus                @default(OPEN)
  requiredCollaborators            Int?
  currentCollaborators             Int                                @default(0)
  requiredSkills                   Json                               @default("[]")
  isAnonymous                      Boolean                            @default(false)
  isApproved                       Boolean                            @default(true)
  createdAt                        DateTime                           @default(now())
  updatedAt                        DateTime                           @updatedAt
  community_collaboration_requests community_collaboration_requests[]
  community_comments               community_comments[]
  community_post_views             community_post_views[]
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  community_reactions              community_reactions[]
  notifications                    notifications[]
  community_saved_posts            community_saved_posts[]
  community_moderation_queue       community_moderation_queue[]

  @@index([createdAt(sort: Desc)])
  @@index([difficulty])
  @@index([domain, difficulty, isApproved])
  @@index([domain])
  @@index([isApproved])
  @@index([likesCount(sort: Desc)])
  @@index([status])
  @@index([status, type, isApproved])
  @@index([trendingScore(sort: Desc)])
  @@index([type])
  @@index([type, isApproved, createdAt(sort: Desc)])
  @@index([type, isApproved, trendingScore(sort: Desc)])
  @@index([userId])
}

model community_reactions {
  id              String          @id @default(dbgenerated("gen_random_uuid()::text"))
  userId          String
  postId          String
  type            ReactionType
  createdAt       DateTime        @default(now())
  community_posts community_posts @relation(fields: [postId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
  @@index([postId])
  @@index([type])
  @@index([userId])
}

model downloads {
  id        String   @id @default(dbgenerated("gen_random_uuid()::text"))
  userId    String
  projectId String
  format    String
  createdAt DateTime @default(now())
  projects  projects @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([projectId])
  @@index([userId])
}

model editor_picks {
  id        String   @id @default(dbgenerated("gen_random_uuid()::text"))
  projectId String   @unique
  reason    String?
  order     Int      @default(0)
  createdAt DateTime @default(now())
  projects  projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([order])
}

model idea_reactions {
  id              String          @id @default(dbgenerated("gen_random_uuid()::text"))
  userId          String
  ideaId          String
  type            ReactionType
  createdAt       DateTime        @default(now())
  community_ideas community_ideas @relation(fields: [ideaId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, ideaId])
  @@index([ideaId])
  @@index([userId])
}

model idea_reports {
  id              String          @id @default(dbgenerated("gen_random_uuid()::text"))
  userId          String
  ideaId          String
  reason          ReportReason
  details         String?
  resolved        Boolean         @default(false)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime @updatedAt
  community_ideas community_ideas @relation(fields: [ideaId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([ideaId])
  @@index([resolved])
  @@index([userId])
}

model projects {
  id                String            @id @default(dbgenerated("gen_random_uuid()::text"))
  slug              String            @unique
  title             String
  shortDescription  String
  fullDescription   String
  domain            ProjectDomain
  difficulty        ProjectDifficulty
  estimatedDuration String
  recommendedYear   String
  primaryTechnology String
  techStack         Json
  architecture      String
  features          Json
  skillsRequired    Json
  learningOutcomes  Json
  timeline          Json
  isPublished       Boolean           @default(true)
  isEditorPick      Boolean           @default(false)
  viewCount         Int               @default(0)
  saveCount         Int               @default(0)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime @updatedAt
  downloads         downloads[]
  editor_picks      editor_picks?
  saved_projects    saved_projects[]

  @@index([createdAt])
  @@index([difficulty])
  @@index([domain, difficulty, primaryTechnology])
  @@index([domain])
  @@index([isEditorPick])
  @@index([isPublished, domain, difficulty])
  @@index([isPublished, domain, isEditorPick, createdAt])
  @@index([isPublished, estimatedDuration])
  @@index([isPublished])
  @@index([isPublished, isEditorPick, createdAt])
  @@index([isPublished, primaryTechnology])
  @@index([isPublished, recommendedYear])
  @@index([primaryTechnology])
  @@index([recommendedYear])
  @@index([shortDescription])
  @@index([slug])
  @@index([title])
}

model saved_projects {
  id        String   @id @default(dbgenerated("gen_random_uuid()::text"))
  userId    String
  projectId String
  createdAt DateTime @default(now())
  projects  projects @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, projectId])
  @@index([projectId])
  @@index([userId])
}

model Session {
  id           String   @id @default(dbgenerated("gen_random_uuid()::text"))
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model subscriptions {
  id                   String           @id @default(dbgenerated("gen_random_uuid()::text"))
  userId               String           @unique
  tier                 SubscriptionTier @default(FREE)
  status               String           @default("active")
  aiCallsUsed          Int              @default(0)
  aiCallsLimit         Int              @default(5)
  downloadsUsed        Int              @default(0)
  downloadsLimit       Int              @default(3)
  stripeCustomerId     String?
  stripePriceId        String?
  stripeSubscriptionId String?
  currentPeriodStart   DateTime?
  currentPeriodEnd     DateTime?
  createdAt            DateTime         @default(now())
  updatedAt            DateTime @updatedAt
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([tier])
  @@index([userId])
}

model user_profiles {
  id                  String   @id @default(dbgenerated("gen_random_uuid()::text"))
  userId              String   @unique
  preferredDomains    String[]
  skillLevel          String?
  academicYear        String?
  institution         String?
  bio                 String?
  github              String?
  linkedin            String?
  portfolio           String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  reputationScore     Int      @default(0)
  totalPosts          Int      @default(0)
  totalLikesReceived  Int      @default(0)
  totalCollaborations Int      @default(0)
  followersCount      Int      @default(0)
  followingCount      Int      @default(0)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([reputationScore(sort: Desc)])
  @@index([userId])
}

model user_followers {
  id           String   @id @default(dbgenerated("gen_random_uuid()::text"))
  followerId   String
  followingId  String
  createdAt    DateTime @default(now())
  follower User @relation("UserFollowers", fields: [followerId], references: [id], onDelete: Cascade)
  following User @relation("UserFollowing", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

model notifications {
  id        String           @id @default(dbgenerated("gen_random_uuid()::text"))
  userId    String
  type      NotificationType
  actorId   String
  postId    String?
  isRead    Boolean          @default(false)
  createdAt DateTime         @default(now())
  user      User             @relation("NotificationRecipient", fields: [userId], references: [id], onDelete: Cascade)
  actor     User             @relation("NotificationActor", fields: [actorId], references: [id], onDelete: Cascade)
  post      community_posts? @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([createdAt(sort: Desc)])
  @@index([userId, isRead])
}

model community_saved_posts {
  id              String          @id @default(dbgenerated("gen_random_uuid()::text"))
  userId          String
  postId          String
  createdAt       DateTime        @default(now())
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  community_posts community_posts @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
  @@index([userId])
  @@index([postId])
  @@index([createdAt(sort: Desc)])
}

model community_moderation_queue {
  id              String          @id @default(dbgenerated("gen_random_uuid()::text"))
  postId          String
  reason          String
  reporterId      String?
  status          String          @default("PENDING")
  reviewedBy      String?
  reviewedAt      DateTime?
  createdAt       DateTime        @default(now())
  community_posts community_posts @relation(fields: [postId], references: [id], onDelete: Cascade)
  reporter User? @relation("ModerationReporter", fields: [reporterId], references: [id], onDelete: SetNull)
  reviewer User? @relation("ModerationReviewer", fields: [reviewedBy], references: [id], onDelete: SetNull)

  @@index([postId])
  @@index([status])
  @@index([createdAt(sort: Desc)])
}

model rate_limits {
  id          String   @id @default(dbgenerated("gen_random_uuid()::text"))
  userId      String
  action      String
  count       Int      @default(1)
  windowStart DateTime @default(now())
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, action])
  @@index([windowStart])
}

model User {
  id                               String                             @id @default(dbgenerated("gen_random_uuid()::text"))
  email                            String                             @unique
  emailVerified                    DateTime?
  name                             String?
  image                            String?
  role                             Role                               @default(STUDENT)
  onboardingComplete               Boolean                            @default(false)
  createdAt                        DateTime                           @default(now())
  updatedAt                        DateTime                           @updatedAt
  accounts                         Account[]
  sessions                         Session[]
  ai_usage_logs                    ai_usage_logs[]
  audit_logs                       audit_logs[]
  community_collaboration_requests community_collaboration_requests[]
  community_comment_reactions      community_comment_reactions[]
  community_comments               community_comments[]
  community_ideas                  community_ideas[]
  community_post_views             community_post_views[]
  community_posts                  community_posts[]
  community_reactions              community_reactions[]
  downloads                        downloads[]
  idea_reactions                   idea_reactions[]
  idea_reports                     idea_reports[]
  saved_projects                   saved_projects[]
  subscriptions                    subscriptions?
  user_profiles                    user_profiles?
  followers                        user_followers[]                   @relation("UserFollowers")
  following                        user_followers[]                   @relation("UserFollowing")
  notifications_received           notifications[]                    @relation("NotificationRecipient")
  notifications_sent               notifications[]                    @relation("NotificationActor")
  community_saved_posts            community_saved_posts[]
  moderation_reports               community_moderation_queue[]       @relation("ModerationReporter")
  moderation_reviews               community_moderation_queue[]       @relation("ModerationReviewer")
  rate_limits                      rate_limits[]

  @@index([email])
  @@index([role])
  @@map("users")
}

enum NotificationType {
  LIKE
  COMMENT
  COLLAB_REQUEST
  COLLAB_ACCEPT
  FOLLOW
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

enum CollaborationStatus {
  OPEN
  CLOSED
}

enum IdeaStatus {
  PENDING
  APPROVED
  REJECTED
  HIDDEN
}

enum PostType {
  IDEA
  COLLABORATION
}

enum ProjectDifficulty {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum ProjectDomain {
  WEB_DEVELOPMENT
  MOBILE_DEVELOPMENT
  DATA_SCIENCE
  MACHINE_LEARNING
  BLOCKCHAIN
  IOT
  GAME_DEVELOPMENT
  CYBERSECURITY
  CLOUD_COMPUTING
  OTHER
  FINTECH
  DEVOPS
  HEALTH_TECH
  ENTERPRISE_SYSTEM
  AI_ML
  EDTECH
  MOBILE
  DEVELOPER_TOOLS
  AI
  AR_VR
  ROBOTICS
  COMPUTER_VISION
  ENERGY
  QUANTUM
  BIOINFORMATICS
  ENVIRONMENTAL
  BACKEND_DEVELOPMENT
  DESKTOP_DEVELOPMENT
}

enum ReactionType {
  LIKE
  DISLIKE
}

enum ReportReason {
  SPAM
  INAPPROPRIATE
  DUPLICATE
  OTHER
}

enum RequestStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum Role {
  STUDENT
  ADMIN
}

enum SubscriptionTier {
  FREE
  PRO
  ENTERPRISE
}




